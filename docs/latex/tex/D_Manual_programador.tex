\apendice{Documentación técnica de programación}

\section{Introducción}\label{introduccion-programador}
En este capítulo vamos a dividirlo en dos partes, por un lado los condiciones específicas propias de la aplicación y por otro vamos a aprender de manera breve y sencilla a crear una aplicación gracias a \emph{Angular CLI}, la interfaz de línea de comandos de Angular.

El por qué he decidido incluir la parte de \emph{Angular CLI} es por que considero que va aclarar muchas dudas acerca de cómo funciona esta tecnología y también para intentar comprender mejor como he realizado el proyecto. En diversas ocasiones para aprender a usar una tecnología tan solo hace falta tiempo pero en otras muchas el tiempo es limitado por lo que quizás con esta pequeña guía podemos comenzar a utilizar un framework cliente en muy pocos pasos y de una manera sencilla. Si bien es cierto que yo he necesitado mucho tiempo para comprender su funcionamiento y no lo he aprendido gracias a la interfaz de comandos, ésta te permite agilizar los trámites de creación en un tanto por ciento considerablemente alto.

Este anexo por tanto tiene como objetivo analizar y documentar las necesidades funcionales que deberán ser soportadas por el sistema a desarrollar, es decir, en qué condiciones ha sido desarrollado, en qué condiciones se debe usar y cuáles son los requerimientos mínimos para que un futuro programador interactúe con la aplicación en caso de que así lo considere.

\section{Requerimientos mínimos necesarios}
Además de un \emph{IDE} para poder trabajar, los prerequisitos mínimos para empezar a trabajar en el proyecto son:

\begin{enumerate}
	\item Instalar \hyperlink{https://nodejs.org/en/}{Nodejs} y \hyperlink{https://www.mongodb.com/}{MongoDB}.
	\item Instalar \hyperlink{https://www.npmjs.com/}{npm}
	\item Instalar Angular CLI
		\lstset{language=C, breaklines=true, basicstyle=\footnotesize}
		\begin{lstlisting}[frame=single]
		npm i -g @angular/cli
    	\end{lstlisting}
\end{enumerate}

Nota: es interesante, una vez instalados asegurarnos de que están correctamente instalados usando los comandos \emph{node -v} y \emph{npm -v} para saber si tenemos los requerimientos correctamente instalados.


\section{AngularCLI}\label{angularCLI}
Sabiendo los requisitos mínimos que son necesarios para proceder vamos a realizar, cómo he nombrado antes una breve introducción a la línea de comandos de Angular,  \textbf{Angular CLI}.

\subsection{¿Qué es typescript?}\label{typesript}
Esto se ha nombrado antes pero resulta esencial para entender el código de Angular. Antes de nada decir que en Angular2 se puede trabajar con Javascript “clásico” (ES5), así como ES6 y TypeScript. Desarrollado por Microsoft y como apuesta de Google vamos a ver el crecimiento exponencial que ha tenido este de este lenguaje, que no deja de ser un super conjunto de JavaScript. 
 TypeScript es por tanto un superset de ECMAScript 6, es decir, incluye todas las funcionalidades de ES6, y además incorpora una capa por encima con funcionalidades extra.

\begin{center}
    \begin{minipage}{0.9\linewidth}
        \vspace{5pt}%margen superior de minipage
        {\small
        \begin{quote}
            TypeScript is a typed superset of JavaScript that compiles to plain JavaScript. Any browser. Any host. Any OS. Open source.
            \end{quote}
        }
        \begin{flushright}
            Typescript Web \cite{typescript}
        \end{flushright}
        \vspace{5pt}%margen inferior de la minipage
    \end{minipage}
\end{center}

La principal característica de TypeScript por encima de Javascript es que permite definir de qué tipo son las variables que se van a usar.

\subsection{Comandos básicos}\label{cbasicos}
\textbf{Angular CLI} nos va a hacer la vida más fácil con Angular, ya que nos permite crear de forma sencilla un aplicación lista para funcionar después de la instalación por línea de comandos con \emph{npm}, además incorpora las buenas prácticas de programación con Angular. 

\imagen{angularclicommands}{Comandos  \emph{AngularCLI}. Fuente:  \url{https://cli.angular.io/}.}

Por lo tanto para crear nuestra aplicación con esta herramienta tan solo debemos ir a nuestra carpeta donde queremos crear el proyecto e introducir en la línea de comandos: 
	\lstset{language=C, breaklines=true, basicstyle=\footnotesize}
		\begin{lstlisting}[frame=single]
		ng new angular-cli-primer-proyecto
    	\end{lstlisting}
 
 Es un proceso que durará unos 2 minutos,  Al finalizar seremos capaces de ejecutar directamente la aplicación por defecto que crea la herramienta. Para ejecutarla, al igual que antes accedemos a la carpeta del proyecto y ejecutamos:
 	\lstset{language=C, breaklines=true, basicstyle=\footnotesize}
		\begin{lstlisting}[frame=single]
		 npm start
    	\end{lstlisting}
    	
    	\imagen{angularcliconsola}{Consola ejecución. Fuente:  \url{http://codigoxules.org/}.}
    	
 Si te fijas en la ejecución se llama al comando \textbf{ng serve} que será el que utilicemos con Angular CLI para trabajar. Resulta realmente útil al introducir el último comando nombrado ya que una vez lanzado se detectan automáticamente los cambios a medida que vamos avanzando la página se recarga al guardar el componente que estemos modificando.  
    	
    	\imagen{angularcliresultado}{Resultado después de creado. Fuente:  \url{http://codigoxules.org/}.}
    	
   Esta es la sencilla manera de crear un proyecto con \textbf{Angular CLI}. Después existen una serie de comandos para crear directamente componentes, servicios, clases, interfaces.. etcétera.  Algunos de ellos son:
   
   
\begin{table}[htbp]
\begin{center}
\begin{tabular}{|l|l|}
\hline
Tipo a crear & Comando  \\
\hline \hline
Component & \emph{ng component my-new-component}  \\ \hline
Directive & \emph{ng g directive my-new-directive}  \\ \hline
Pipe & \emph{ng g pipe my-new-pipe}  \\ \hline
Service & \emph{ng g service my-new-service}  \\ \hline
Class & \emph{ng g class my-new-class}  \\ \hline
Interface & \emph{ng g interface my-new-interface}  \\ \hline
Enum & \emph{ng g enum my-new-enum}  \\ \hline
\end{tabular}
\caption{Tabla comandos Angular CLI}
\label{tabla:sencilla}
\end{center}
\end{table}
   


\section{Manual del programador}
En esta sección hay que tener en cuenta que el autor de este trabajo proyecto a escogido unas serie de herramientas, tanto para desplegar la app, como la base de datos como para desarrollar la aplicación pero que de ninguna manera resultan ser ni las únicas ni las mejores simplemente son unas herramientas que ha considerado utilizar pero existen muchas más que no son ni peores ni mejores.

\subsection{Prerequisitos}
\begin{enumerate}
	\item Instalar \hyperlink{https://nodejs.org/en/}{Nodejs} y \hyperlink{https://www.mongodb.com/}{MongoDB}.
	\item Instalar \hyperlink{https://www.npmjs.com/}{npm}
	\item Instalar Angular CLI
		\lstset{language=C, breaklines=true, basicstyle=\footnotesize}
		\begin{lstlisting}[frame=single]
		npm i -g @angular/cli
    	\end{lstlisting}
    \item Descargar el proyecto ( \emph{git clone} ) o bien desde un soporte
	\item Una vez tenemos el proyecto descargado en nuestro sistema local desde el directorio raíz (vía línea de comandos) instalar las dependencias necesarias.
	\lstset{language=C, breaklines=true, basicstyle=\footnotesize}
		\begin{lstlisting}[frame=single]
		npm install
    	\end{lstlisting}
\end{enumerate}


\subsection{Estructura de directorios }

La estructura de directorios general es la siguiente:

%Foto erronea cambiar!
\imagen{directorios}{Vista carpetas general  \emph{BarterAPP}. Fuente: Elaboración propia.}

\begin{itemize}
	\item \textbf{$/client/$}: \emph{Front-End} 
	\begin{itemize}
	\item \textbf{$/client/app$}: Carpeta App
		\begin{itemize}
		\item \textbf{$/client/app/ _directives$}: directivas
		\item \textbf{$/client/app/ _guards$}: rutas (autenticaciones)
		\item \textbf{$/client/app/ _models$}: modelos
		\item \textbf{$/client/app/ _services$}:  servicios
		\item \textbf{$/client/app/enviroments$}:  entornos
		\item \textbf{$/client/app/pages/$}:  páginas
			\begin{itemize}
			\item \textbf{$/client/app/pages/angular_calendar $}:  calendario
			\item \textbf{$/client/app/pages/home $}:   home
			\item \textbf{$/client/app/pages/login $}:  login
			\item \textbf{$/client/app/pages/register $}:   registro
			\item \textbf{$/client/app/pages/welcome $}:   vista inicial
			\end{itemize}
		\item \textbf{$/client/app/repository $}:  repositorio (conexión con el servidor)
		\item \textbf{$/client/app/utils $}:   útiles
		\end{itemize}
	\item \textbf{$/client/assets $}: recursos  
	\item \textbf{$/client/enviroments $}:  entornos
   \end{itemize}
	\item \textbf{$/dist/ $}: ficheros para subir a servidor web
	\item \textbf{$/e2e/ $}: tests
	\item \textbf{$/node_modules/ $}: módulos
	\item \textbf{$/server/ $}:  \emph{Back-End} 
		\begin{itemize}
			\item \textbf{$/server/config $}: configuración
			\item \textbf{$/server/controllers $}: controladores
			\item \textbf{$/node_modules/ $}: módulos
			\item \textbf{$/server/routes $}: rutas
			\item \textbf{$/server/services $}: servicios
		\end{itemize}
\end{itemize}

%Directorios apaisado
\begin{landscape}
\begin{adjustbox}{width=\linewidth}
{\footnotesize
  \begin{forest}
    for tree={
      parent anchor=south,
      child anchor=north,
      trapezium,
      trapezium angle=95,
      rounded corners=2pt,
      draw,
      l sep=1.9cm,
      s sep=0.4cm,
      fill=blue!50,
    }
    [/
       [$/client$, fill=blue!50, for children={fill=green!50}
        [/$app$, fill=green!!50, for children={fill=yellow!50}
         [$ _directives$
         ]
         [$ _guards$
         ]
         [$ _models$
         ]
         [$ _services$
         ]
         [$ _enviroments$
         ]
          [/$pages$, fill=yellow!!50, for children={fill=orange!50}
          [$angular_calendar$
          ]
          [$home$
          ]
          [$login$
          ]
          [$register$
          ]
          [$welcome$
          ]
         ]
         [$_repository$
         ]
         [$_utils$
         ]
        ]
        [$/assets$
        ]
         [$/enviroments$
        ]
      ]
      [$/e2e$
      ]
      [$/dist$
      ]
      [$/node _ modules$
      ]
         [$/server$, fill=blue!50, for children={fill=green!50}
        [$/config$
        ]
        [$/controllers$
        ]
        [$/node _ modules$
        ]
        [$/routes$
        ]
        [$/services$
        ]
      ]
]
    ]
  \end{forest}
  }
\end{adjustbox}
  \end{landscape}

Cada parte de la aplicación ha tenido lugares desde donde he obtenido la información, vamos a desgranar las partes principales de la aplicación. Esta sección junto con el anexo anterior (Anexo D: diseño) harán que comprendamos el funcionamiento de la aplicación definitivamente.

Todos los componentes en angular tienen una estructura interna exactamente igual:



%Analisis
\begin{description}
	\item[$/app/_directives$] Las directivas son una parte esencial de una aplicación angular, en este caso las alertas se utilizan para mostrarse en registro/login de la aplicación
	
	Los enlaces en los que me he apoyado :
	\begin{itemize}
	\item Observables 
	 d\url{http://academia-binaria.com/comunicaciones-http-observables-con-angular2/}
    \end{itemize}

	
	
	\item[$/app/_guards$] más información sobre el segundo item.
\end{description}






Observables
http://academia-binaria.com/comunicaciones-http-observables-con-angular2/

angular2 polling -observables
https://stackoverflow.com/questions/41658162/how-to-do-polling-with-angular-2-observables

Guards
https://blog.thoughtram.io/angular/2016/07/18/guards-in-angular-2.html

Interpolacion
http://academia-binaria.com/databinding-el-flujo-de-datos-de-angular2/

DTO
https://stackoverflow.com/questions/39272947/dto-design-in-typescript-angular2

ngAfterViewInit
https://angular.io/docs/ts/latest/api/core/index/AfterViewInit-class.html


PrimeNg
%https://www.primefaces.org/primeng/#/

Growl
%https://www.primefaces.org/primeng/#/growl

Login/Register tutorial
%http://jasonwatmore.com/post/2016/09/29/angular-2-user-registration-and-login-example-tutorial#register-component-html

AngularCalendar
https://github.com/mattlewis92/angular-bootstrap-calendar

Multiple components
https://angular.io/docs/ts/latest/tutorial/toh-pt3.html

Tutorial angular2 components
https://scotch.io/tutorials/creating-your-first-angular-2-components

https://desarrolloweb.com/articulos/analisis-carpetas-proyecto-angular2.html


https://desarrolloweb.com/articulos/introduccion-componentes-angular2.html

http://academia-binaria.com/hola-mundo-en-angular-2/


\subsection{Modo desarrollador}

Hay que tener en cuenta que tenemos diversas tecnologías dentro del proyecto por lo que resulta un poco costoso tener que ejecutar todas por separado, que es lo que hacía en un principio. Con el modo desarrollador (emula al \textbf{ng serve} nombrado antes, tan solo con el comando siguiente ejecutamos MongoDB, Angular, Express y el compilador de Typescript luego ya no nos hace falta nada más y podemos comenzar a trabajar. 

	\lstset{language=C, breaklines=true, basicstyle=\footnotesize}
		\begin{lstlisting}[frame=single]
		npm run dev
    	\end{lstlisting}

\subsection{Servidor (Heroku)}
Para subir la aplicación al servidor yo he elegido \hyperlink{https://www.heroku.com/}{Heroku} y los pasos para lanzar la aplicación son los que se enumeran a continuación:

\begin{enumerate}
	\item Acceder a la \hyperlink{https://www.heroku.com/}{web} de \emph{Heroku}, registrarse y crear una nueva app.
	\item Instalar \hyperlink{https://devcenter.heroku.com/articles/heroku-cli}{Heroku CLI}
	\item Ejecutar los siguientes comandos:
		\lstset{language=C, breaklines=true, basicstyle=\footnotesize}
		\begin{lstlisting}[frame=single]
		heroku login
		cd my-project/
		git init
		heroku git:remote -a your-app-name
    	\end{lstlisting}
	\item Descargar el proyecto BarterApp desde github 
	\item Editar el servidor(Ruta: \emph{server/config/db.ts}) para introducir un servidor real con MongoDB (lo veremos en la sección siguiente)
	\item Ejecutar los siguientes comandos:
		\lstset{language=C, breaklines=true, basicstyle=\footnotesize}
		\begin{lstlisting}[frame=single]
		npm i
		ng build -prod or ng build -aot -prod
		tsc -p server
		git add .
		git commit -m "Going to Heroku"
		git push heroku master
		heroku open
    	\end{lstlisting}
	\item Una venta se abrirá con tu aplicación ya online
\end{enumerate}

Resumiendo de esta manera utilizamos Heroku como si de github se tratase y vamos aplicando los cambios que hacemos a nuestra aplicación al repositorio creado en Heroku, la ventaja que ya tenemos la aplicación lanzada en un entorno real. Es una restricción importante que ya no podemos trabajar con una base de datos local sino que tiene que ser un servidor remoto con MongoDB ( en este caso) para que la aplicación funcione.
	

\subsection{Base de datos (Mlab)}
La base de datos escogida es MongoDB, la instalación es fácil y sencilla tan solo hay que ir a la \hyperlink{http://www.mongodb.org/downloads}{web} oficial y descargar la última versión estable disponible. Una vez en nuestro ordenador la ejecutamos y listo.  Si tenéis algún problema os recomiendo seguir alguno de los tutoriales que existen en la web. https://www.adictosaltrabajo.com/tutoriales/mongodb/

Como sabemos podemos manejar la base de datos desde línea de comandos pero resulta un poco pesado cuando empezamos a tener muchas colecciones o un número de datos alto. Es por eso que yo recomiendo encarecidamente  \hyperlink{https://robomongo.org/}{Robomongo}, la copia de SQL server para bases de datos NoSQL.  Interfaz no muy lograda pero perfecta para visualizar nuestras bases de datos e información de una manera más intuitiva.

	\imagen{robomongoview}{Vista Robomongo. Fuente:  Elaboración propia.}
	
	Esta claro que cuando trabajamos con un proyecto en local para realizar pruebas lo mejor es tener una base de datos en local pero cuando queremos algo un poco más serio resulta interesante el tener esa base de datos en un servidor real. Para ello he escogido \hyperlink{mlab.com}{Mlab}, los pasos para crear la base de datos se enumeran a continuación: 
	
	\begin{enumerate}
	\item Acceder a la \hyperlink{mlab.com}{Mlab}, registrarse y crear una cuenta
	\item Crear una subscripción a una base de datos (Tiene de pago pero también tiene una versión gratuita que nos vale para realizar pruebas a este nivel)
	\item Ejecutar el siguiente comando para establecer la conexión con la base de datos creada
		\lstset{language=C, breaklines=true, basicstyle=\footnotesize}
		\begin{lstlisting}[frame=single]
		mongo ds012345.mlab.com:56789/dbname -u dbuser -p dbpassword
    	\end{lstlisting}
	\item Las colecciones las podemos crear directamente desde la propia web, o bien desde la lína de comandos 
	\item Para probar que la base de datos funciona (El primer comando es para insertar un elemento y el segundo para buscar. En este caso el segundo debería devolver el único elemento insertado.:
		\lstset{language=C, breaklines=true, basicstyle=\footnotesize}
		\begin{lstlisting}[frame=single]
		db.mynewcollection.insert({ "foo" : "bar" })
		db.mynewcollection.find() 
    	\end{lstlisting}	
\end{enumerate}

Nota: para empezar a trabajar con este proyecto es necesario crear las tres colecciones de las que ya hemos hablado en secciones anteriores: \emph{Users, Events, Interchange}, y \underline{no} hacer nada más puesto que según la configuración de la aplicación se debería añadir los usuarios, eventos y turnos de manera automática cuando el usuario hacer click en los botones adecuados. 


\begin{itemize}
  \item Stack MEAN
  \begin{itemize}
    \item \textbf{M}ongoose.js (MongoDB):  base de datos
    \item \textbf{E}xpress.js: backend framework
    \item \textbf{A}ngular 4: frontend framework
    \item \textbf{N}ode.js: entorno tiempo de ejecución
  \end{itemize}
  \item Otras tecnologías que se utilizan:
  \begin{itemize}
    \item Angular CLI
    \item Boostrap
    \item Font Awesome
    \item JSON WEB TOKEN
  \end{itemize}
\end{itemize}




